#!/bin/sh
#================================================================================
# 一括deploy
#================================================================================
#--------------------------------------------------
# 変数定義
#--------------------------------------------------
DIR_SCRIPT=$(cd $(dirname $0);pwd)
DIR_LOG=${DIR_SCRIPT}/log
FILE_LOG=`basename $0 .sh`.log
PATH_LOG=${DIR_LOG}/${FILE_LOG}

EXEC_CMD="mvn -am clean deploy -Dmaven.test.skip=true"


#--------------------------------------------------
# 事前処理
#--------------------------------------------------
cd ${DIR_SCRIPT}

if [ ! -e ${DIR_LOG} ]; then
    mkdir ${DIR_LOG}
fi


#--------------------------------------------------
# 主処理
#--------------------------------------------------
cd ..
echo ${EXEC_CMD} | tee -a ${PATH_LOG}
${EXEC_CMD} | tee -a ${PATH_LOG} 2>&1
if [ $? -ne 0 ]; then
    echo build failure ${EXEC_CMD_PARENT} | tee -a ${PATH_LOG}
    exit 1
fi


#--------------------------------------------------
# 事後処理
#--------------------------------------------------
exit 0
